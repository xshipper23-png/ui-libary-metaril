local Library = {}

function Library:CreateWindow(Settings)
    Settings = Settings or {}
    
    -- Variablen aus Settings
    local hubName = Settings.Name or "Meta Hub"
    local keys = Settings.Keys or {"Admin"}
    local keyLink = Settings.KeyLink or ""
    local discord = Settings.Discord or ""
    local ytLink = Settings.YoutubeLink or ""
    
    local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
    ScreenGui.Name = "MetaLib"
    ScreenGui.ResetOnSpawn = false

    -- --- LOGIK: NOTES LADEN ---
    local finalNotes = Settings.NotesContent or "Keine News."
    if Settings.NotesFromLink and Settings.NotesLink then
        local s, content = pcall(function() return game:HttpGet(Settings.NotesLink) end)
        if s then finalNotes = content end
    end

    -- --- KEY SYSTEM UI (Aus deiner Datei) ---
    local KeySys = Instance.new("Frame", ScreenGui)
    KeySys.Name = "key sys"
    KeySys.Size = UDim2.new(0, 350, 0, 250)
    KeySys.Position = UDim2.new(0.5, -175, 0.5, -125)
    KeySys.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    KeySys.Visible = Settings.KeySystem
    Instance.new("UICorner", KeySys)

    local KeyInput = Instance.new("TextBox", KeySys)
    KeyInput.Name = "key eingabe"
    KeyInput.Size = UDim2.new(0.8, 0, 0, 40)
    KeyInput.Position = UDim2.new(0.1, 0, 0.4, 0)
    KeyInput.Text = ""
    KeyInput.PlaceholderText = "Enter Key hier..."

    local CheckBtn = Instance.new("TextButton", KeySys)
    CheckBtn.Name = "check key"
    CheckBtn.Size = UDim2.new(0.4, 0, 0, 30)
    CheckBtn.Position = UDim2.new(0.3, 0, 0.7, 0)
    CheckBtn.Text = "Check Key"

    -- --- MAIN HUB (Aus deiner Datei) ---
    local Main = Instance.new("Frame", ScreenGui)
    Main.Name = "main background frame"
    Main.Size = UDim2.new(0, 510, 0, 314)
    Main.Position = UDim2.new(0.5, -255, 0.5, -157)
    Main.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    Main.Visible = not Settings.KeySystem
    Instance.new("UICorner", Main)

    -- Name Anzeige
    local NameLabel = Instance.new("TextLabel", Main)
    NameLabel.Name = "name des key sestem"
    NameLabel.Size = UDim2.new(0, 272, 0, 28)
    NameLabel.Position = UDim2.new(0.012, 0, 0.016, 0)
    NameLabel.BackgroundColor3 = Color3.fromRGB(152, 152, 152)
    NameLabel.Text = hubName
    Instance.new("UICorner", NameLabel)

    -- Notes Content
    local Notes = Instance.new("TextLabel", Main)
    Notes.Name = "notes content"
    Notes.Size = UDim2.new(0, 200, 0, 100)
    Notes.Position = UDim2.new(0.5, 0, 0.3, 0)
    Notes.Text = finalNotes
    Notes.TextWrapped = true

    -- --- BUTTON LOGIK ---
    CheckBtn.MouseButton1Click:Connect(function()
        for _, k in pairs(keys) do
            if KeyInput.Text == k then
                KeySys.Visible = false
                Main.Visible = true
                return
            end
        end
        KeyInput.Text = "FALSCH!"
    end)

    if Settings.DiscordButton then
        local DiscBtn = Instance.new("TextButton", Main)
        DiscBtn.Name = "discord link"
        DiscBtn.Text = "Discord Kopieren"
        DiscBtn.Size = UDim2.new(0, 100, 0, 30)
        DiscBtn.Position = UDim2.new(0.1, 0, 0.8, 0)
        DiscBtn.MouseButton1Click:Connect(function() setclipboard(discord) end)
    end

    -- Draggable Funktion hinzuf√ºgen
    local function makeDraggable(frame)
        local inputService = game:GetService("UserInputService")
        local dragging, dragInput, dragStart, startPos
        frame.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true; dragStart = input.Position; startPos = frame.Position
            end
        end)
        inputService.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local delta = input.Position - dragStart
                frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            end
        end)
        frame.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)
    end
    
    makeDraggable(Main)
    makeDraggable(KeySys)

    return Main
end

return Library
